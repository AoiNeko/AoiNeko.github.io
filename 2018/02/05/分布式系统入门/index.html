<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="langley, liangli171@gmail.com"><title>分布式系统入门 · AoiNeko</title><meta name="description" content="CAP定理任何分布式系统只能实现C(consistency),A (available),P(Partition Tolerance) 三者之二。一致性，可用性，分区容忍
保证C,P:保证数据一致性以及节点可分区，那么在更新数据时要使更新的节点以外的节点不可用，即丧失了A保证A,P: 允许至少一个节"><meta name="keywords" content="Hexo,Java"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="/images/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"></head><body><e class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/images/mylogo.jpg" style="width:127px;"><h3 title=""><a href="/">AoiNeko</a></h3><div class="description"><p>一些个记录</p></div></div></div><ul class="social-links"></ul><div class="footer"><a target="_blank" href="/"></a><div class="by_farbox"><a href="https://hexo.io/zh-cn/" target="_blank">Hexo&#65281;</a></div></div></e><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="/">首页</a></li><li><a href="/archives">归档</a></li></div><div class="information"><div class="back_btn"><li><a onclick="window.history.go(-1)" class="fa fa-chevron-left"> </a></li></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>分布式系统入门</a></h3></div><div class="post-content"><h3 id="CAP定理"><a href="#CAP定理" class="headerlink" title="CAP定理"></a>CAP定理</h3><p>任何分布式系统只能实现C(consistency),A (available),P(Partition Tolerance) 三者之二。一致性，可用性，分区容忍</p>
<p>保证C,P:保证数据一致性以及节点可分区，那么在更新数据时要使更新的节点以外的节点不可用，即丧失了A<br>保证A,P: 允许至少一个节点更新状态，会导致数据的不一致<br>保证C,A: 必须保证节点之间可以相互通信，即网络不可分区</p>
<p>分布式系统的设计时需要考虑如何牺牲一时的数据一致性来保证系统的高可用。</p>
<h3 id="ACID与BASE"><a href="#ACID与BASE" class="headerlink" title="ACID与BASE"></a>ACID与BASE</h3><p>传统数据库系统设计注重的一致性的ACID分别代表了</p>
<p>A(Atomicity) 原子性，C(Consistency) 一致性，I(Isolation) 隔离性，D(Duration) 持久性</p>
<p>A：一个事物(transaction)的所有操作要么全部完成，要么全部不完成。如果事物中发生错误，数据库将进行回滚，恢复事物开始之前的情况。<br>C：事物开始结束之后数据库的完整性没有被破坏。写入的数据完全符合所有的预设规则。<br>I：防止并发事物交叉执行导致数据不一致。事物隔离级别： READ UNCOMMITTED, READ COMMITTED, REPEATABLE READ, SERIALIZABLE.<br>D：事物处理结束后，对数据的修改就是永久的，即使系统故障，断电也不会丢失</p>
<p>BASE： Basically Available,Soft state, Eventually consistent.<br>分布式系统的特点即 基本可用，软状态，最终一致性<br>我们无法做到强一致性，但是可以根据业务的特点，使用适当的方式来保证业务的最终一致性。对用户来说，暂时的等待之后获得正确的结果远比直接收到服务不可用的体验更好。</p>
<h3 id="Eventually-Consistency"><a href="#Eventually-Consistency" class="headerlink" title="Eventually Consistency"></a>Eventually Consistency</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">最终一致性通常不会是分布式系统一个明确的需求。在实现一个高可用和可扩展的系统时，我们不得不牺牲一些常用策略，而这些策略正是保证强一致性的前提。</div></pre></td></tr></table></figure>
<p>   在分布式系统中，一个应用实例查看的数据可能是另外的操作正在操作中的状态，这次查看的数据就处在暂时的不一致中。 根据需求开发者要设计应用来侦测并处理这种不一致，必要时解决产生的不一致。</p>
<p>   一点需要了解的是，应用并不需要数据在任何时间都是一致的。如典型电商应用中，用户打开一个商品查看库存同时另外的用户下单购买了同一个商品。此时不需要去更新还在查看中的用户的库存数字，只需要在他下单时判断是不是还有存活，提醒他商品已售出或者将延长发货时间。</p>
<h3 id="Pattern"><a href="#Pattern" class="headerlink" title="Pattern"></a>Pattern</h3><h4 id="失败重试："><a href="#失败重试：" class="headerlink" title="失败重试："></a>失败重试：</h4><p>   在分布式系统中，操作未能完成通常都是由于暂时的错误(通讯失败一般)。如果出现失败，应用假设这是暂时的，在得到失败的结果时简单的重复之前失败的步骤。这样有可能导致要执行的步骤在第一次实际上执行过但是由于网络问题没能返回，调用应用重试时导致同一个操作执行了两次或者更多。<br>   所以设计系统时要使这种重复的执行无害化。<br>      一种策略是使调用的服务或者步骤幂等(idempotent).即一连串的操作在成功执行过一次以后，如果被重复再调用，而不会对系统的状态产生影响。实现这种策略会很大以于具体系统业务，需要对系统和业务两者都有深刻理解。<br>   比如电商系统中的支付业务， 调用服务使每一次payment都附带一个唯一的identifier，接收者在获得这个服务的调用时，先比较之前有没有同样的identifier的支付记录后再开始支付操作。</p>
<h4 id="数据分区和使用幂等命令"><a href="#数据分区和使用幂等命令" class="headerlink" title="数据分区和使用幂等命令"></a>数据分区和使用幂等命令</h4><p>多个实例同时修改同一数据是导致达成最终一致性失败的另一个常见原因。尽量将系统设计得更原子性，通过划分系统来减少并发的实例执行互相间冲突的操作。跳出单纯的考虑CRUD，思考如何通过更原子的命令构建系统使业务逻辑幂等的执行。<br> <a href="https://docs.microsoft.com/en-us/azure/architecture/patterns/cqrs" target="_blank" rel="external">读写分离 (Command and Query Responsibility Segregation)</a>, <a href="https://docs.microsoft.com/en-us/azure/architecture/patterns/event-sourcing" target="_blank" rel="external">事件驱动(Event Sourcing)</a></p>
<h4 id="补偿事物"><a href="#补偿事物" class="headerlink" title="补偿事物"></a>补偿事物</h4><p>一般最终还是会有某些操作不可以完成的情况(可能是业务原因)，这时实现补偿逻辑来回滚之前已经执行的操作。即是<a href="https://msdn.microsoft.com/en-gb/library/dn589804.aspx" target="_blank" rel="external">补偿事物</a></p>
</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2018-02-05</span><i class="fa fa-tag"></i></div></div></div></div><div class="share"><div class="evernote"><a href="javascript:(function(){EN_CLIP_HOST='http://www.evernote.com';try{var%20x=document.createElement('SCRIPT');x.type='text/javascript';x.src=EN_CLIP_HOST+'/public/bookmarkClipper.js?'+(new%20Date().getTime()/100000);document.getElementsByTagName('head')[0].appendChild(x);}catch(e){location.href=EN_CLIP_HOST+'/clip.action?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title);}})();" ref="nofollow" target="_blank" class="fa fa-bookmark"></a></div><div class="weibo"><a href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));" class="fa fa-weibo"></a></div><div class="twitter"><a href="http://twitter.com/home?status=,http://yoursite.com/2018/02/05/分布式系统入门/,AoiNeko,分布式系统入门,;" class="fa fa-twitter"></a></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a role="navigation" href="/2018/02/06/读写分离模式/" title="读写分离模式" class="btn">上一篇</a></li><li class="next pagbuttons"><a role="navigation" href="/2018/01/07/logstash/" title="logstash记录" class="btn">下一篇</a></li></ul></div></div></div></div></div><script src="/js/jquery.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script></body></html>